define Tank 272136332
define Sensor -1252983604
define Vent 938836756
define Pump -321403609
define LiquidTank 1988118157
define Drain 1687692899

define O2Tank HASH("O2 Compressor Tank")
define Co2Tank HASH("Co2 Compressor Tank")
define HabO2Tank HASH("Hab O2 Tank")
define HabCo2Tank HASH("Hab Co2 Tank")

alias CurrentLight r8
alias CompressorPressure r9
alias HabTankPressure r10
alias Temp r11
alias CurrentTank r12
alias CurrentHabTank r13
alias CurrentPump r14
alias CurrentVent r15
start:
yield

l r0 Sensor Temperature
s -815193061 HASH("Exterior Temp Display") Setting r0

beq CurrentTank O2Tank SetCo2
j SetO2

Run:
l CompressorPressure Tank CurrentTank Pressure
l HabTankPressure  CurrentHabTank  Pressure
# Check if room in compressor and if temp is ok
slt r0 233 #-40C
slt r1 CompressorPressure 5000
add r0 r0 r1
beq r0 2 RunCompressor


bgt HabTankPressure 30000 Idle
# Check if tank is clean.
s r0 CompressorTank RatioPollutant
bgtz r0 Idle
s r0 CompressorTank RatioLiquidPollutant
bgtz r0 Idle
#if current tank is Co2 skip the other checks
beq CurrentTank Co2Tank EmptyCompressor

s r0 CompressorTank RatioCarbonDioxide
bgtz r0 Idle
s r0 CompressorTank RatioLiquidCarbonDioxide
bgtz r0 Idle

j EmptyCompressor

RunCompressor:
s Pump CurrentPump On 0
s Vent CurrentVent On 1
s 1944485013 HASH("Compressor Light") Color 4 # Red
beq CurrentTank O2Tank SetCo2
j start

EmptyCompressor:
s Pump CurrentPump On 1
s Vent CurrentVent On 0
s 1944485013 HASH("Compressor Light") Color 2 # Green
beq CurrentTank O2Tank SetCo2
j start

Idle:
s Pump CurrentPump On 0
s Vent CurrentVent On 0
s 1944485013 HASH("Compressor Light") Color 5 # Yellow
beq CurrentTank O2Tank SetCo2
j start

SetO2:
move CurrentTank O2Tank
move CurrentHabTank HabO2Tank
move CurrentPump HASH("O2 Output Pump")
move CurrentVent HASH(O2 Vent)
move CurrentLight HASH("O2 Compressor Light")
j Run
SetCo2:
move CurrentTank Co2Tank
move CurrentHabTank HabCo2Tank
move CurrentPump HASH("Co2 Output Pump")
move CurrentVent HASH("Co2 Vent")
move CurrentLight HASH("Co2 Compressor Light")
j Run
